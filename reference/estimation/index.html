
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../drift/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>estimation - mercury-monitoring</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#estimation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="mercury-monitoring" class="md-header__button md-logo" aria-label="mercury-monitoring" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mercury-monitoring
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              estimation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/BBVA/mercury-monitoring/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    mercury-monitoring
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mercury-monitoring" class="md-nav__button md-logo" aria-label="mercury-monitoring" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    mercury-monitoring
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/BBVA/mercury-monitoring/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    mercury-monitoring
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Api
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Api
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift/" class="md-nav__link">
        drift
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          estimation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        estimation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation" class="md-nav__link">
    estimation
  </a>
  
    <nav class="md-nav" aria-label="estimation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor" class="md-nav__link">
    performance_predictor
  </a>
  
    <nav class="md-nav" aria-label="performance_predictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor.PerformancePredictor" class="md-nav__link">
    PerformancePredictor
  </a>
  
    <nav class="md-nav" aria-label="PerformancePredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor.PerformancePredictor.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor.PerformancePredictor.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation" class="md-nav__link">
    estimation
  </a>
  
    <nav class="md-nav" aria-label="estimation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor" class="md-nav__link">
    performance_predictor
  </a>
  
    <nav class="md-nav" aria-label="performance_predictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor.PerformancePredictor" class="md-nav__link">
    PerformancePredictor
  </a>
  
    <nav class="md-nav" aria-label="PerformancePredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor.PerformancePredictor.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.estimation.performance_predictor.PerformancePredictor.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="estimation">Estimation</h1>


<div class="doc doc-object doc-module">



<h2 id="mercury.monitoring.estimation" class="doc doc-heading">
          <code>mercury.monitoring.estimation</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.estimation.performance_predictor" class="doc doc-heading">
          <code>performance_predictor</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.estimation.performance_predictor.PerformancePredictor" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">PerformancePredictor</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">metric_fn</span><span class="p">,</span> <span class="n">corruptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">percentiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">performance_predictor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">K_cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">store_train_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">


  
      <p>This class allow us to estimate the performance of a model on an unlabeled dataset, for example to monitor performance
in production data when we still don't have the labels. The method is based on the paper
Learning to Validate the Predictions of Black Box Classifiers on Unseen Data. In a nutshell, the steps of the method are:</p>
<p>1) Apply corruptions to a held-out (labeld) dataset
2) Obtain percentiles of model outputs and the performance of the model when applying these corruptions
3) Train a regressor model to predict model performance. The samples to train this regressor model are the percentiles and
    performances obtained in 2)
4) Use the trained regressor to estimate the performance on serving unlabeled data</p>
<p>According to the paper, the method works well when: 1) We have a situation of covariate (changes in input data distributions) and
2) We know in advance what kind of covariate shift we can find in our serving data. However, in our experiments we have found
that in some situations the method still works when the data also suffers from label shift.
At the same time, it is important to mention that the method is not 100% accurate and cannot detect performance drop in all cases.</p>
<p>Original paper:
https://ssc.io/pdf/mod0077s.pdf</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>BaseEstimator</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The model that we want to estimate the performance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metric_fn</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Function that calculates the metric that we want to estimate. The function should accept the true labels as
first argument and the predictions as the second argument. For example, you can use functions from sklearn.metrics module.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>corruptions</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional list of corruptions to apply in the dataset specified in <code>fit</code> method.
If we specify them, we use a list of tuples where each tuple has two elements:</p>
<p>1) A string with the type of drift to apply.
2) A dictionary with the parameters of the drift to apply. For the first element you can use any method available in
mercury.monitoring.drift.drift_simulation.BatchDriftGenerator class. In the second element, the parameters are the
arguments of the drift function. You can see the tutorial of class or the BatchDriftGenerator documentation for more
details. If not specified the corruptions will be added in the <code>fit()</code> method according to the drift detected.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>percentiles</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>, <span title="numpy">np</span>.<span title="numpy.array">array</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.array or list with percentiles to calculate in model outputs to be used as features in the regressor.
By default, the calculated percentiles are [0, 5, 10, ..., 95, 100]</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>performance_predictor</code></td>
          <td>
                <code>BaseEstimator</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(unfitted) model to use as regressor. By default it will be a RandomForestRegressor with n_estimators=15</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>param_grid</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary with the hyperparameters grid that will be used when doing a grid search when training the regressor.
By default just the the max_depth of the RandomForestRegressor is tunned.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>K_cv</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of folds to use when doing the GridSearch cross-validation to train the regressor. By default 5 will be used</p>
            </div>
          </td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>random_state</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>random state to use in the RandomForestRegressor. By default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>store_train_data</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to store the data to train the regressor in the attributes <code>X_train_regressor</code> and
<code>y_train_regressor</code>. This can be useful for analysis when performing some experiments of the method. By default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mercury.monitoring.estimation.performance_predictor</span> <span class="kn">import</span> <span class="n">PerformancePredictor</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">performance_predictor</span> <span class="o">=</span> <span class="n">PerformancePredictor</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">metric_fn</span><span class="o">=</span><span class="n">accuracy_score</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">performance_predictor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">df_test</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df_test</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">X_serving</span><span class="o">=</span><span class="n">df_serving</span><span class="p">[</span><span class="n">features</span><span class="p">])</span>
</code></pre></div>
</details>
          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/estimation/performance_predictor.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="s2">&quot;BaseEstimator&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
    <span class="n">metric_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">corruptions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">percentiles</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">performance_predictor</span><span class="p">:</span> <span class="s2">&quot;BaseEstimator&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
    <span class="n">param_grid</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">K_cv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">store_train_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class allow us to estimate the performance of a model on an unlabeled dataset, for example to monitor performance</span>
<span class="sd">    in production data when we still don&#39;t have the labels. The method is based on the paper</span>
<span class="sd">    Learning to Validate the Predictions of Black Box Classifiers on Unseen Data. In a nutshell, the steps of the method are:</span>

<span class="sd">    1) Apply corruptions to a held-out (labeld) dataset</span>
<span class="sd">    2) Obtain percentiles of model outputs and the performance of the model when applying these corruptions</span>
<span class="sd">    3) Train a regressor model to predict model performance. The samples to train this regressor model are the percentiles and</span>
<span class="sd">        performances obtained in 2)</span>
<span class="sd">    4) Use the trained regressor to estimate the performance on serving unlabeled data</span>

<span class="sd">    According to the paper, the method works well when: 1) We have a situation of covariate (changes in input data distributions) and</span>
<span class="sd">    2) We know in advance what kind of covariate shift we can find in our serving data. However, in our experiments we have found</span>
<span class="sd">    that in some situations the method still works when the data also suffers from label shift.</span>
<span class="sd">    At the same time, it is important to mention that the method is not 100% accurate and cannot detect performance drop in all cases.</span>

<span class="sd">    Original paper:</span>
<span class="sd">    https://ssc.io/pdf/mod0077s.pdf</span>

<span class="sd">    Args:</span>
<span class="sd">        model: The model that we want to estimate the performance</span>
<span class="sd">        metric_fn: Function that calculates the metric that we want to estimate. The function should accept the true labels as</span>
<span class="sd">            first argument and the predictions as the second argument. For example, you can use functions from sklearn.metrics module.</span>
<span class="sd">        corruptions: Optional list of corruptions to apply in the dataset specified in `fit` method.</span>
<span class="sd">            If we specify them, we use a list of tuples where each tuple has two elements:</span>

<span class="sd">            1) A string with the type of drift to apply.</span>
<span class="sd">            2) A dictionary with the parameters of the drift to apply. For the first element you can use any method available in</span>
<span class="sd">            mercury.monitoring.drift.drift_simulation.BatchDriftGenerator class. In the second element, the parameters are the</span>
<span class="sd">            arguments of the drift function. You can see the tutorial of class or the BatchDriftGenerator documentation for more</span>
<span class="sd">            details. If not specified the corruptions will be added in the `fit()` method according to the drift detected.</span>

<span class="sd">        percentiles: np.array or list with percentiles to calculate in model outputs to be used as features in the regressor.</span>
<span class="sd">            By default, the calculated percentiles are [0, 5, 10, ..., 95, 100]</span>
<span class="sd">        performance_predictor: (unfitted) model to use as regressor. By default it will be a RandomForestRegressor with n_estimators=15</span>
<span class="sd">        param_grid: dictionary with the hyperparameters grid that will be used when doing a grid search when training the regressor.</span>
<span class="sd">            By default just the the max_depth of the RandomForestRegressor is tunned.</span>
<span class="sd">        K_cv: Number of folds to use when doing the GridSearch cross-validation to train the regressor. By default 5 will be used</span>
<span class="sd">        random_state: random state to use in the RandomForestRegressor. By default is None.</span>
<span class="sd">        store_train_data: whether to store the data to train the regressor in the attributes `X_train_regressor` and</span>
<span class="sd">            `y_train_regressor`. This can be useful for analysis when performing some experiments of the method. By default is False.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt; from mercury.monitoring.estimation.performance_predictor import PerformancePredictor</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.metrics import accuracy_score</span>
<span class="sd">        &gt;&gt;&gt; performance_predictor = PerformancePredictor(model, metric_fn=accuracy_score, random_state=42)</span>
<span class="sd">        &gt;&gt;&gt; performance_predictor.fit(X=df_test[features], y=df_test[label], X_serving=df_serving[features])</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metric_fn</span> <span class="o">=</span> <span class="n">metric_fn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corruptions</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">corruptions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">corruptions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">percentiles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">percentiles</span>
    <span class="k">if</span> <span class="n">performance_predictor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">performance_predictor_unfitted</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">performance_predictor_unfitted</span> <span class="o">=</span> <span class="n">performance_predictor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;absolute_error&#39;</span><span class="p">]}</span> <span class="k">if</span> <span class="n">param_grid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">param_grid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">K_cv</span> <span class="o">=</span> <span class="n">K_cv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">store_train_data</span> <span class="o">=</span> <span class="n">store_train_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">performance_predictor</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.estimation.performance_predictor.PerformancePredictor.fit" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dataset_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names_categorical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_serving</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Fits the regressor to predict the performance using a dataset not used as training data.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pandas dataframe with the inputs of our model. It should be a held-out dataset not used to train the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[pandas.<span title="pandas.DataFrame">DataFrame</span>, <span title="numpy">np</span>.<span title="numpy.array">array</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>corresponding labels of <code>X</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataset_schema</code></td>
          <td>
                <code>mercury.<span title="mercury.dataschema">dataschema</span>.<span title="mercury.dataschema.DataSchema">DataSchema</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a DataSchema object. If not passed, it is created automatically</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>names_categorical</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of categorical columns. Only used if <code>dataset_schema</code> is not specified. In that case, it
will take this list as categorical columns</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>X_serving</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>optional dataframe with the serving data (without labels). If specified, it will detect drift between
<code>X</code> and <code>X_serving</code> and the corruptions will be added based on that drift.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/estimation/performance_predictor.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">X</span><span class="p">:</span> <span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;np.array&quot;</span><span class="p">],</span>  <span class="c1"># noqa: F821</span>
    <span class="n">dataset_schema</span><span class="p">:</span> <span class="s2">&quot;mercury.dataschema.DataSchema&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
    <span class="n">names_categorical</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">X_serving</span><span class="p">:</span> <span class="s2">&quot;pandas.DataFrame&quot;</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># noqa: F821</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the regressor to predict the performance using a dataset not used as training data.</span>

<span class="sd">    Args:</span>
<span class="sd">        X: Pandas dataframe with the inputs of our model. It should be a held-out dataset not used to train the model</span>
<span class="sd">        y: corresponding labels of `X`</span>
<span class="sd">        dataset_schema: a DataSchema object. If not passed, it is created automatically</span>
<span class="sd">        names_categorical: list of categorical columns. Only used if `dataset_schema` is not specified. In that case, it</span>
<span class="sd">            will take this list as categorical columns</span>
<span class="sd">        X_serving: optional dataframe with the serving data (without labels). If specified, it will detect drift between</span>
<span class="sd">            `X` and `X_serving` and the corruptions will be added based on that drift.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Generate Schema</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_generate_schema</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dataset_schema</span><span class="p">,</span> <span class="n">names_categorical</span><span class="p">)</span>

    <span class="c1"># if X_serving is passed, then add new error generators based on data drift</span>
    <span class="k">if</span> <span class="n">X_serving</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corruptions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_corruptions_from_data_drift</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X_serving</span><span class="p">))</span>

    <span class="c1"># if we have very few corruptions (less than param K_cv), raise a warning a create scale drift</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corruptions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K_cv</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Very corruptions have been specified or created from data drift. &quot;</span>
            <span class="s2">&quot;scale dirft will be added for all features individually&quot;</span><span class="p">)</span>
        <span class="n">continous_feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_schema</span><span class="o">.</span><span class="n">continuous_feats</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_schema</span><span class="o">.</span><span class="n">discrete_feats</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">continous_feats</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corruptions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_scale_drift</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">f</span><span class="p">))</span>

    <span class="n">X_train_regressor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_train_regressor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">corruption</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corruptions</span><span class="p">:</span>

        <span class="n">corruption_fn</span> <span class="o">=</span> <span class="n">corruption</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">corruption_args</span> <span class="o">=</span> <span class="n">corruption</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Apply drift generator</span>
        <span class="n">X_corrupt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_corruption</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">corruption_fn</span><span class="p">,</span> <span class="n">corruption_args</span><span class="p">)</span>

        <span class="c1"># Score on corrupted examples</span>
        <span class="n">y_hat_corrupt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_corrupt</span><span class="p">)</span>
        <span class="n">score_corrupt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_fn</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat_corrupt</span><span class="p">)</span>

        <span class="c1"># Statitics of model outputs (percentiles)</span>
        <span class="n">statistics_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_statistics_model_outputs</span><span class="p">(</span><span class="n">X_corrupt</span><span class="p">)</span>

        <span class="c1"># Add data point to samples for performance predictor</span>
        <span class="n">X_train_regressor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statistics_outputs</span><span class="p">)</span>
        <span class="n">y_train_regressor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score_corrupt</span><span class="p">)</span>

    <span class="c1"># Train performance predictor regressor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fit_performance_predictor</span><span class="p">(</span><span class="n">X_train_regressor</span><span class="p">,</span> <span class="n">y_train_regressor</span><span class="p">)</span>

    <span class="c1"># Store performance predictor trai data if specified</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_train_data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train_regressor</span> <span class="o">=</span> <span class="n">X_train_regressor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train_regressor</span> <span class="o">=</span> <span class="n">y_train_regressor</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.estimation.performance_predictor.PerformancePredictor.predict" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X_serving</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns the estimated performance on <code>X_serving</code></p>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/estimation/performance_predictor.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_serving</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the estimated performance on `X_serving`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Statistics Model Outputs</span>
    <span class="n">statistics_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_statistics_model_outputs</span><span class="p">(</span><span class="n">X_serving</span><span class="p">)</span>

    <span class="c1"># Predict Score on Serving Data</span>
    <span class="n">predicted_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance_predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">statistics_outputs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">predicted_score</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>


  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>