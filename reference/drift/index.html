
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../estimation/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>drift - mercury-monitoring</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#drift" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="mercury-monitoring" class="md-header__button md-logo" aria-label="mercury-monitoring" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mercury-monitoring
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              drift
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/BBVA/mercury-monitoring/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    mercury-monitoring
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mercury-monitoring" class="md-nav__button md-logo" aria-label="mercury-monitoring" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    mercury-monitoring
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/BBVA/mercury-monitoring/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    mercury-monitoring
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Api
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Api
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          drift
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        drift
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mercury.monitoring.drift" class="md-nav__link">
    drift
  </a>
  
    <nav class="md-nav" aria-label="drift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector" class="md-nav__link">
    auto_encoder_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="auto_encoder_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector" class="md-nav__link">
    AutoEncoderDriftDetector
  </a>
  
    <nav class="md-nav" aria-label="AutoEncoderDriftDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.is_fitted" class="md-nav__link">
    is_fitted
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base" class="md-nav__link">
    base
  </a>
  
    <nav class="md-nav" aria-label="base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector" class="md-nav__link">
    BaseBatchDriftDetector
  </a>
  
    <nav class="md-nav" aria-label="BaseBatchDriftDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.get_drifted_features" class="md-nav__link">
    get_drifted_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_distribution_drifted_features" class="md-nav__link">
    plot_distribution_drifted_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_distribution_feature" class="md-nav__link">
    plot_distribution_feature()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_feature_drift_scores" class="md-nav__link">
    plot_feature_drift_scores()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_histograms_drifted_features" class="md-nav__link">
    plot_histograms_drifted_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_histograms_feature" class="md-nav__link">
    plot_histograms_feature()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.chi2_drift_detector" class="md-nav__link">
    chi2_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="chi2_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.chi2_drift_detector.Chi2Drift" class="md-nav__link">
    Chi2Drift
  </a>
  
    <nav class="md-nav" aria-label="Chi2Drift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.chi2_drift_detector.Chi2Drift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector" class="md-nav__link">
    density_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="density_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector" class="md-nav__link">
    DensityDriftDetector
  </a>
  
    <nav class="md-nav" aria-label="DensityDriftDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.explain" class="md-nav__link">
    explain()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.predict_embeddings" class="md-nav__link">
    predict_embeddings()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.domain_classifier_drift_detector" class="md-nav__link">
    domain_classifier_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="domain_classifier_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.domain_classifier_drift_detector.DomainClassifierDrift" class="md-nav__link">
    DomainClassifierDrift
  </a>
  
    <nav class="md-nav" aria-label="DomainClassifierDrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.domain_classifier_drift_detector.DomainClassifierDrift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation" class="md-nav__link">
    drift_simulation
  </a>
  
    <nav class="md-nav" aria-label="drift_simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" class="md-nav__link">
    BatchDriftGenerator
  </a>
  
    <nav class="md-nav" aria-label="BatchDriftGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.__get_rotation_matrix" class="md-nav__link">
    __get_rotation_matrix()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.__remap_categorical" class="md-nav__link">
    __remap_categorical()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.hyperplane_rotation_drift" class="md-nav__link">
    hyperplane_rotation_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.missing_val_drift" class="md-nav__link">
    missing_val_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.outliers_drift" class="md-nav__link">
    outliers_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.recodification_drift" class="md-nav__link">
    recodification_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.scale_drift" class="md-nav__link">
    scale_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.shift_drift" class="md-nav__link">
    shift_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.histogram_distance_drift_detector" class="md-nav__link">
    histogram_distance_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="histogram_distance_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.histogram_distance_drift_detector.HistogramDistanceDrift" class="md-nav__link">
    HistogramDistanceDrift
  </a>
  
    <nav class="md-nav" aria-label="HistogramDistanceDrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.histogram_distance_drift_detector.HistogramDistanceDrift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.ks_drift_detector" class="md-nav__link">
    ks_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="ks_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.ks_drift_detector.KSDrift" class="md-nav__link">
    KSDrift
  </a>
  
    <nav class="md-nav" aria-label="KSDrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.ks_drift_detector.KSDrift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics" class="md-nav__link">
    metrics
  </a>
  
    <nav class="md-nav" aria-label="metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.bootstrap_eval_drift" class="md-nav__link">
    bootstrap_eval_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.hellinger_distance" class="md-nav__link">
    hellinger_distance()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.jeffreys_divergence" class="md-nav__link">
    jeffreys_divergence()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.psi" class="md-nav__link">
    psi()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../estimation/" class="md-nav__link">
        estimation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mercury.monitoring.drift" class="md-nav__link">
    drift
  </a>
  
    <nav class="md-nav" aria-label="drift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector" class="md-nav__link">
    auto_encoder_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="auto_encoder_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector" class="md-nav__link">
    AutoEncoderDriftDetector
  </a>
  
    <nav class="md-nav" aria-label="AutoEncoderDriftDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.is_fitted" class="md-nav__link">
    is_fitted
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base" class="md-nav__link">
    base
  </a>
  
    <nav class="md-nav" aria-label="base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector" class="md-nav__link">
    BaseBatchDriftDetector
  </a>
  
    <nav class="md-nav" aria-label="BaseBatchDriftDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.get_drifted_features" class="md-nav__link">
    get_drifted_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_distribution_drifted_features" class="md-nav__link">
    plot_distribution_drifted_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_distribution_feature" class="md-nav__link">
    plot_distribution_feature()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_feature_drift_scores" class="md-nav__link">
    plot_feature_drift_scores()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_histograms_drifted_features" class="md-nav__link">
    plot_histograms_drifted_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_histograms_feature" class="md-nav__link">
    plot_histograms_feature()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.chi2_drift_detector" class="md-nav__link">
    chi2_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="chi2_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.chi2_drift_detector.Chi2Drift" class="md-nav__link">
    Chi2Drift
  </a>
  
    <nav class="md-nav" aria-label="Chi2Drift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.chi2_drift_detector.Chi2Drift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector" class="md-nav__link">
    density_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="density_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector" class="md-nav__link">
    DensityDriftDetector
  </a>
  
    <nav class="md-nav" aria-label="DensityDriftDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.explain" class="md-nav__link">
    explain()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.predict_embeddings" class="md-nav__link">
    predict_embeddings()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.domain_classifier_drift_detector" class="md-nav__link">
    domain_classifier_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="domain_classifier_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.domain_classifier_drift_detector.DomainClassifierDrift" class="md-nav__link">
    DomainClassifierDrift
  </a>
  
    <nav class="md-nav" aria-label="DomainClassifierDrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.domain_classifier_drift_detector.DomainClassifierDrift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation" class="md-nav__link">
    drift_simulation
  </a>
  
    <nav class="md-nav" aria-label="drift_simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" class="md-nav__link">
    BatchDriftGenerator
  </a>
  
    <nav class="md-nav" aria-label="BatchDriftGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.__get_rotation_matrix" class="md-nav__link">
    __get_rotation_matrix()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.__remap_categorical" class="md-nav__link">
    __remap_categorical()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.hyperplane_rotation_drift" class="md-nav__link">
    hyperplane_rotation_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.missing_val_drift" class="md-nav__link">
    missing_val_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.outliers_drift" class="md-nav__link">
    outliers_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.recodification_drift" class="md-nav__link">
    recodification_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.scale_drift" class="md-nav__link">
    scale_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.shift_drift" class="md-nav__link">
    shift_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.histogram_distance_drift_detector" class="md-nav__link">
    histogram_distance_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="histogram_distance_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.histogram_distance_drift_detector.HistogramDistanceDrift" class="md-nav__link">
    HistogramDistanceDrift
  </a>
  
    <nav class="md-nav" aria-label="HistogramDistanceDrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.histogram_distance_drift_detector.HistogramDistanceDrift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.ks_drift_detector" class="md-nav__link">
    ks_drift_detector
  </a>
  
    <nav class="md-nav" aria-label="ks_drift_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.ks_drift_detector.KSDrift" class="md-nav__link">
    KSDrift
  </a>
  
    <nav class="md-nav" aria-label="KSDrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.ks_drift_detector.KSDrift.calculate_drift" class="md-nav__link">
    calculate_drift()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics" class="md-nav__link">
    metrics
  </a>
  
    <nav class="md-nav" aria-label="metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.bootstrap_eval_drift" class="md-nav__link">
    bootstrap_eval_drift()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.hellinger_distance" class="md-nav__link">
    hellinger_distance()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.jeffreys_divergence" class="md-nav__link">
    jeffreys_divergence()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mercury.monitoring.drift.metrics.psi" class="md-nav__link">
    psi()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="drift">Drift</h1>


<div class="doc doc-object doc-module">



<h2 id="mercury.monitoring.drift" class="doc doc-heading">
          <code>mercury.monitoring.drift</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.auto_encoder_drift_detector" class="doc doc-heading">
          <code>auto_encoder_drift_detector</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">AutoEncoderDriftDetector</span><span class="p">(</span><span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">bootstrap_samples</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">bootstrap_sample_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">autoencoder_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_reconstruction_error</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="n">fitted_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reference_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">

  
      <p>This class uses several autoencoders for testing whether the joint distributions of two
datasets are the same. In order to do this, it makes bootstrap samples from a source
dataset (X_src), trains an autoencoder on each one of them (using training/test splits) and
it stores the distribution of reconstruction errors (i.e. the error distribution reconstructing the
source dataset). The default reconstruction error is the MSE, although you can specify your own.</p>
<p>Then, when target data is available (X_target), it calculates the error distribution on the new
environment and compares it with the one obtained on X_src by using a Mann-Withney-U statistical test
under the null hypothesis (H0) that no drift exists (that is, the two error samples come from the same
distribution).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>p_val</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Significance level for rejecting the null hypothesis. Default value is 0.05.</p>
            </div>
          </td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>bootstrap_samples</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How many bootstrap samples to make</p>
            </div>
          </td>
          <td>
                <code>30</code>
          </td>
        </tr>
        <tr>
          <td><code>bootstrap_sample_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of each bootstrap sample.</p>
            </div>
          </td>
          <td>
                <code>10000</code>
          </td>
        </tr>
        <tr>
          <td><code>autoencoder_kwargs</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary with arguments for training the internal <code>n</code> autoencoders.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_reconstruction_error</code></td>
          <td>
                <code>callable or string</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Custom function for measuring reconstruction quality. This is only used for the
drift calculation, not for training the autoencoders (use autoencoder_kwargs for that). This
can be a string in (mse, rmse, mae), meaning (Mean Squared Error, Root Mean Squared Error,
Mean Absolute Loss error). Alternatively, you can also provide a custom function with the form
<code>custom_fn(ytrue, ypred)</code> that returns the reconstruction error without reductions. That is,
a matrix with the same shape as ytrue/ypred. Default is Mean squared error.</p>
            </div>
          </td>
          <td>
                <code>&#39;mse&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>fitted_models</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List with trained autoencoders (tf.keras.Model). Use it only if you want to "reload" an
already trained detector.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reference_errors</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List with the errors obtained at the time of training the detector. Use it only
if you want to "reload" an already trained detector.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mercury.monitoring.drift.auto_encoder_drift_detector</span> <span class="kn">import</span> <span class="n">AutoEncoderDriftDetector</span>
<span class="c1"># Create example datasets</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># Train the detector on the source dataset</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span> <span class="o">=</span> <span class="n">AutoEncoderDriftDetector</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_src</span><span class="p">)</span>
<span class="c1"># Use the detector for checking whether drift exists on X_target</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">calculate_drift</span><span class="p">(</span><span class="n">X_target</span><span class="p">)</span>
<span class="s2">&quot;{&#39;pval&#39;: 7.645836962858183e-06, &#39;drift&#39;: True}&quot;</span>
</code></pre></div>
</details>

          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/auto_encoder_drift_detector.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">p_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
             <span class="n">bootstrap_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
             <span class="n">bootstrap_sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10_000</span><span class="p">,</span>
             <span class="n">autoencoder_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">custom_reconstruction_error</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;mse&#39;</span><span class="p">,</span>
             <span class="n">fitted_models</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">reference_errors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_samples</span> <span class="o">=</span> <span class="n">bootstrap_samples</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_sample_size</span> <span class="o">=</span> <span class="n">bootstrap_sample_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pval</span> <span class="o">=</span> <span class="n">p_val</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ae_args</span> <span class="o">=</span> <span class="n">autoencoder_kwargs</span> <span class="k">if</span> <span class="n">autoencoder_kwargs</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_metric_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reconstruction_err_fn</span><span class="p">(</span><span class="n">custom_reconstruction_error</span><span class="p">)</span>

    <span class="c1"># Support case when user &quot;reloads&quot; the detector</span>
    <span class="k">if</span> <span class="n">fitted_models</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reference_errors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_errors</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitted_models</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;If you pass a list of recovered fitted models you must also provide a list of &quot;&quot;&quot;</span>
<span class="w">                             </span><span class="sd">&quot;&quot;&quot;reference_errors of the same length as `fitted_models`.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitted_models</span> <span class="o">=</span> <span class="n">fitted_models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_distribution</span> <span class="o">=</span> <span class="n">reference_errors</span>
    <span class="k">if</span> <span class="n">reference_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fitted_models</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For reloading the detector you must pass both `reference_errors` and `fitted_models`.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ae_args</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error. autoencoer_kwargs must be a dictionary.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_init_autoencoder_params</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.is_fitted" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">is_fitted</span><span class="p">:</span> <span class="nb">bool</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Whether the detector has been fitted and it's ready for calculating drift</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.calculate_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">calculate_drift</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">return_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Checks whether drift exists on a given dataset using X_src as reference:</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the target dataset.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>return_errors</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to include the reconstruction errors in the result.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary containing the result of the test and, optionally, the reference</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>and target reconstruction errors.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/auto_encoder_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">return_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Checks whether drift exists on a given dataset using X_src as reference:</span>

<span class="sd">    Args:</span>
<span class="sd">        X: the target dataset.</span>
<span class="sd">        return_errors: Whether to include the reconstruction errors in the result.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing the result of the test and, optionally, the reference</span>
<span class="sd">        and target reconstruction errors.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error. This detector han&#39;t been trained yet. Call `fit` first.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">target_distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_real_error_distr</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">test</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mse_reference</span><span class="p">[</span><span class="s1">&#39;mses&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_target</span><span class="p">[</span><span class="s1">&#39;mses&#39;</span><span class="p">],</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;less&#39;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pval&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">pvalue</span><span class="p">,</span>
        <span class="s1">&#39;drift&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pval</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">return_errors</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;source_errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_reference</span><span class="p">[</span><span class="s1">&#39;mses&#39;</span><span class="p">]</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;target_errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_target</span><span class="p">[</span><span class="s1">&#39;mses&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector.fit" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X_src</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Trains the detector using a source (reference) dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X_src</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the reference dataset.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector" href="#mercury.monitoring.drift.auto_encoder_drift_detector.AutoEncoderDriftDetector">AutoEncoderDriftDetector</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the detector itself.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/auto_encoder_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_src</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AutoEncoderDriftDetector&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Trains the detector using a source (reference) dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        X_src: the reference dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the detector itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reference_distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_simulation_error_distr</span><span class="p">(</span><span class="n">X_src</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.base" class="doc doc-heading">
          <code>base</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.base.BaseBatchDriftDetector" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">BaseBatchDriftDetector</span><span class="p">(</span><span class="n">X_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Base class for batch drift detection.
The class can be extended to create a method for batch drift detection over a source dataset <code>X_src</code> and target
dataset <code>X_target</code>, or a source dataset distributions <code>distr_src</code> and a target dataset distributions <code>distr_target</code>
The main method to implement is the  <code>calculate_drift()</code> method.</p>


          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">X_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s2">&quot;bonferroni&quot;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X_src</span> <span class="o">=</span> <span class="n">X_src</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X_target</span> <span class="o">=</span> <span class="n">X_target</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distr_src</span> <span class="o">=</span> <span class="n">distr_src</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distr_target</span> <span class="o">=</span> <span class="n">distr_target</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">=</span> <span class="n">correction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p_val</span> <span class="o">=</span> <span class="n">p_val</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.base.BaseBatchDriftDetector.calculate_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">calculate_drift</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Method to implement in extended classes</p>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">calculate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to implement in extended classes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.base.BaseBatchDriftDetector.get_drifted_features" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_drifted_features</span><span class="p">(</span><span class="n">return_as_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the features that are considered to have drift. The method <code>calculate_drift</code> needs to be called first.
The parameter <code>return_as_indices</code> controls whether to return the features as indices or names.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>return_as_indices</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to return the features as indices or names.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>features with drift.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_drifted_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_as_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the features that are considered to have drift. The method `calculate_drift` needs to be called first.</span>
<span class="sd">    The parameter `return_as_indices` controls whether to return the features as indices or names.</span>

<span class="sd">    Args:</span>
<span class="sd">        return_as_indices (boolean): whether to return the features as indices or names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): features with drift.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;p_vals&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;threshold&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">drifted_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">])):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;p_vals&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]:</span>
                <span class="n">drifted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;individual p-values need to be calculated to obtain features features. &quot;</span>
            <span class="s2">&quot;Call calculate_drit() first or use a drift method that calculates p-values per feature.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_as_indices</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">drifted_features</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feature indices are not setted&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">drifted_features</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_distribution_drifted_features" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">plot_distribution_drifted_features</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">common_bins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Plots the distributions of the features that are considered to have drift. The method <code>calculate_drift</code>
needs to be called first.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>figsize</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>figsize to use if <code>ax</code> is not specified.</p>
            </div>
          </td>
          <td>
                <code>(8, 4)</code>
          </td>
        </tr>
        <tr>
          <td><code>kde</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to show the smoothed distribution. Default is True</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>stat</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Aggregate statistic to compute in each bin. By default is 'density'. Valid values can be checked in
seaborn documentation</p>
            </div>
          </td>
          <td>
                <code>&#39;density&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>common_bins</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, use the same bins for the target and source dataset. By default is True</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>common_norm</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True and using a normalized statistic, the normalization will apply over the full dataset (src and target).
Otherwise, the normalization is applied to each set independently. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Extra key arguments that can be passed to seaborn <code>histplot</code>.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_distribution_drifted_features</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span>
    <span class="n">common_bins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the distributions of the features that are considered to have drift. The method `calculate_drift`</span>
<span class="sd">    needs to be called first.</span>

<span class="sd">    Args:</span>
<span class="sd">        figsize (tuple):</span>
<span class="sd">            figsize to use if `ax` is not specified.</span>
<span class="sd">        kde (bool):</span>
<span class="sd">            whether to show the smoothed distribution. Default is True</span>
<span class="sd">        stat (str):</span>
<span class="sd">            Aggregate statistic to compute in each bin. By default is &#39;density&#39;. Valid values can be checked in</span>
<span class="sd">            seaborn documentation</span>
<span class="sd">        common_bins (bool):</span>
<span class="sd">            If True, use the same bins for the target and source dataset. By default is True</span>
<span class="sd">        common_norm (bool):</span>
<span class="sd">            If True and using a normalized statistic, the normalization will apply over the full dataset (src and target).</span>
<span class="sd">            Otherwise, the normalization is applied to each set independently. Default is False.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Extra key arguments that can be passed to seaborn `histplot`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">drifted_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drifted_features</span><span class="p">(</span><span class="n">return_as_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">drifted_features</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_distribution_feature</span><span class="p">(</span>
            <span class="n">idx_feature</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="n">kde</span><span class="p">,</span> <span class="n">common_bins</span><span class="o">=</span><span class="n">common_bins</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="n">common_norm</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_distribution_feature" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">plot_distribution_feature</span><span class="p">(</span><span class="n">idx_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">common_bins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Plots the distribution of a given feature for the source and the target datasets.
The feature can be indicated by the index using the <code>idx_feature</code> parameter, or by the name using the
<code>name_feature</code> parameter (only possible if attribute <code>features</code> was specified.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>idx_feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>index of the feature</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>name_feature</code></td>
          <td>
                <code>string</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>name of the feature</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ax</code></td>
          <td>
                <code>matplotlib.<span title="matplotlib.axes">axes</span>.<span title="matplotlib.axes._subplots">_subplots</span>.<span title="matplotlib.axes._subplots.AxesSubplot">AxesSubplot</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Axes object on which the data will be plotted. If not specified it creates one.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>figsize</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>figsize to use if <code>ax</code> is not specified.</p>
            </div>
          </td>
          <td>
                <code>(8, 4)</code>
          </td>
        </tr>
        <tr>
          <td><code>kde</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to show the smoothed distribution. Default is True</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>stat</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Aggregate statistic to compute in each bin. By default is 'density'. Valid values can be checked in
seaborn documentation</p>
            </div>
          </td>
          <td>
                <code>&#39;density&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>common_bins</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, use the same bins for the target and source dataset. By default is True</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>common_norm</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True and using a normalized statistic, the normalization will apply over the full dataset (src and target).
Otherwise, the normalization is applied to each set independently. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Extra key arguments that can be passed to seaborn <code>histplot</code>.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The axes</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_distribution_feature</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">idx_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">name_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span>
    <span class="n">common_bins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the distribution of a given feature for the source and the target datasets.</span>
<span class="sd">    The feature can be indicated by the index using the `idx_feature` parameter, or by the name using the</span>
<span class="sd">    `name_feature` parameter (only possible if attribute `features` was specified.</span>
<span class="sd">    Args:</span>
<span class="sd">        idx_feature (int):</span>
<span class="sd">            index of the feature</span>
<span class="sd">        name_feature (string):</span>
<span class="sd">            name of the feature</span>
<span class="sd">        ax (matplotlib.axes._subplots.AxesSubplot):</span>
<span class="sd">            Axes object on which the data will be plotted. If not specified it creates one.</span>
<span class="sd">        figsize (tuple):</span>
<span class="sd">            figsize to use if `ax` is not specified.</span>
<span class="sd">        kde (bool):</span>
<span class="sd">            whether to show the smoothed distribution. Default is True</span>
<span class="sd">        stat (str):</span>
<span class="sd">            Aggregate statistic to compute in each bin. By default is &#39;density&#39;. Valid values can be checked in</span>
<span class="sd">            seaborn documentation</span>
<span class="sd">        common_bins (bool):</span>
<span class="sd">            If True, use the same bins for the target and source dataset. By default is True</span>
<span class="sd">        common_norm (bool):</span>
<span class="sd">            If True and using a normalized statistic, the normalization will apply over the full dataset (src and target).</span>
<span class="sd">            Otherwise, the normalization is applied to each set independently. Default is False.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Extra key arguments that can be passed to seaborn `histplot`.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The axes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_datasets</span><span class="p">()</span>
    <span class="n">idx_feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_index_feature</span><span class="p">(</span><span class="n">idx_feature</span><span class="p">,</span> <span class="n">name_feature</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">X_src</span><span class="p">[:,</span> <span class="n">idx_feature</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_target</span><span class="p">[:,</span> <span class="n">idx_feature</span><span class="p">]))</span>
    <span class="n">n_samples_src</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_src</span><span class="p">[:,</span> <span class="n">idx_feature</span><span class="p">])</span>
    <span class="n">n_samples_target</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_target</span><span class="p">[:,</span> <span class="n">idx_feature</span><span class="p">])</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">data_plot</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dataset source&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_samples_src</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;dataset target&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_samples_target</span><span class="p">,</span>
        <span class="n">kde</span><span class="o">=</span><span class="n">kde</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span>
        <span class="n">common_bins</span><span class="o">=</span><span class="n">common_bins</span><span class="p">,</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="n">common_norm</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">axes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_feature_drift_scores" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">plot_feature_drift_scores</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Plots a summary of the scores for each feature. The meaning of the score depends on the subclass that is used.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>top_k</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If specified, plots only the top_k features with higher scores.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ax</code></td>
          <td>
                <code>matplotlib.<span title="matplotlib.axes">axes</span>.<span title="matplotlib.axes._subplots">_subplots</span>.<span title="matplotlib.axes._subplots.AxesSubplot">AxesSubplot</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Axes object on which the data will be plotted. If not specified it creates one.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>figsize</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Size of the plotted figure</p>
            </div>
          </td>
          <td>
                <code>(8, 4)</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_feature_drift_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots a summary of the scores for each feature. The meaning of the score depends on the subclass that is used.</span>

<span class="sd">    Args:</span>
<span class="sd">        top_k (int):</span>
<span class="sd">            If specified, plots only the top_k features with higher scores.</span>
<span class="sd">        ax (matplotlib.axes._subplots.AxesSubplot):</span>
<span class="sd">            Axes object on which the data will be plotted. If not specified it creates one.</span>
<span class="sd">        figsize (tuple):</span>
<span class="sd">            Size of the plotted figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Drift must be calculated first to calculate feature drift scores&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;scores&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This drift methods doesn&#39;t have the drift scores calculated yet&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># if feature names are not given, we use the indices</span>
        <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">])))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>

    <span class="c1"># Sort features</span>
    <span class="n">sorted_pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">],</span> <span class="n">features</span><span class="p">))</span>
    <span class="n">sorted_importances</span><span class="p">,</span> <span class="n">sorted_features</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span> <span class="k">for</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_pairs</span><span class="p">)]</span>

    <span class="c1"># Get top k if specified</span>
    <span class="k">if</span> <span class="n">top_k</span><span class="p">:</span>
        <span class="n">sorted_features</span> <span class="o">=</span> <span class="n">sorted_features</span><span class="p">[</span><span class="o">-</span><span class="n">top_k</span><span class="p">:]</span>
        <span class="n">sorted_importances</span> <span class="o">=</span> <span class="n">sorted_importances</span><span class="p">[</span><span class="o">-</span><span class="n">top_k</span><span class="p">:]</span>

    <span class="c1"># Create plot</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">sorted_features</span><span class="p">],</span> <span class="p">[</span><span class="n">imp</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">sorted_importances</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;feature drift scores&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_histograms_drifted_features" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">plot_histograms_drifted_features</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Plots the histograms of the features that are considered to have drift. The method <code>calculate_drift</code>
needs to be called first.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>figsize</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>figsize to use if <code>ax</code> is not specified.</p>
            </div>
          </td>
          <td>
                <code>(8, 4)</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_histograms_drifted_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the histograms of the features that are considered to have drift. The method `calculate_drift`</span>
<span class="sd">    needs to be called first.</span>

<span class="sd">    Args:</span>
<span class="sd">        figsize (tuple):</span>
<span class="sd">            figsize to use if `ax` is not specified.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">drifted_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drifted_features</span><span class="p">(</span><span class="n">return_as_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">drifted_features</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_histograms_feature</span><span class="p">(</span><span class="n">idx_feature</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;histogram source &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;histogram target &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;histogram source &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;histogram target &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.base.BaseBatchDriftDetector.plot_histograms_feature" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">plot_histograms_feature</span><span class="p">(</span><span class="n">idx_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Plots the histograms of a given feature for the source and the target distributions.
The feature can be indicated by the index using the <code>idx_feature</code> parameter, or by the name using the
<code>name_feature</code> parameter (only possible if attribute <code>features</code> was specified.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>idx_feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>index of the feature</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>name_feature</code></td>
          <td>
                <code>string</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>name of the feature</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>figsize</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>figsize to use if <code>ax</code> is not specified.</p>
            </div>
          </td>
          <td>
                <code>(8, 4)</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The axes</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/base.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_histograms_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_feature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the histograms of a given feature for the source and the target distributions.</span>
<span class="sd">    The feature can be indicated by the index using the `idx_feature` parameter, or by the name using the</span>
<span class="sd">    `name_feature` parameter (only possible if attribute `features` was specified.</span>
<span class="sd">    Args:</span>
<span class="sd">        idx_feature (int):</span>
<span class="sd">            index of the feature</span>
<span class="sd">        name_feature (string):</span>
<span class="sd">            name of the feature</span>
<span class="sd">        figsize (tuple):</span>
<span class="sd">            figsize to use if `ax` is not specified.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The axes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_distributions</span><span class="p">()</span>
    <span class="n">idx_feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_index_feature</span><span class="p">(</span><span class="n">idx_feature</span><span class="p">,</span> <span class="n">name_feature</span><span class="p">)</span>
    <span class="c1"># Plot distributions using histograms in different plots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distr_src</span><span class="p">[</span><span class="n">idx_feature</span><span class="p">])),</span> <span class="bp">self</span><span class="o">.</span><span class="n">distr_src</span><span class="p">[</span><span class="n">idx_feature</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distr_target</span><span class="p">[</span><span class="n">idx_feature</span><span class="p">])),</span> <span class="bp">self</span><span class="o">.</span><span class="n">distr_target</span><span class="p">[</span><span class="n">idx_feature</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;histogram source&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;histogram target&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.chi2_drift_detector" class="doc doc-heading">
          <code>chi2_drift_detector</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.chi2_drift_detector.Chi2Drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">Chi2Drift</span><span class="p">(</span><span class="n">distr_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.base.BaseBatchDriftDetector" href="#mercury.monitoring.drift.base.BaseBatchDriftDetector">BaseBatchDriftDetector</a></code></p>

  
      <p>The Chi2Drift class  allows us to detect drift in the source dataset distributions <code>distr_src</code> and the
target dataset distributions <code>distr_target</code> by performing a chi-square test of independence of variables in a
contingency table for each feature. It does it separately for each feature, calculating the statistic and the
p-value. The source and target distributions are specified when creating the object. Then, the method
<code>calculate_drift()</code> is used to obtain a dict of metrics.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>distr_src</code></td>
          <td>
                <code>list of np.arrays</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source dataset distributions. It's a list of np.arrays, where each np.array represents the counts of
each bin for that feature. The features and its bins must be in the same order than the <code>distr_target</code></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>distr_target</code></td>
          <td>
                <code>list of np.arrays</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target dataset distributions. It's a list of np.arrays, where each np.array represents the counts of
each bin for that feature. The features and its bins must be in the same order than the <code>distr_src</code></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the features of <code>X_src</code> and <code>X_target</code>.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>p_val</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Threshold to be used with the p-value obtained to decide if there is drift or not (affects
<code>drift_detected</code> metric when calling <code>calculate_drift()</code>)
Lower values will be more conservative when indicating that drift exists in the dataset.
Default value is 0.05.</p>
            </div>
          </td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>correction</code></td>
          <td>
                <code>string</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Since multiple tests are performed, this parameter controls whether to perform a correction of the p-value
or not (affects <code>drift_detected</code> metric when calling <code>calculate_drift()</code>). If None, it doesn't perform
a correction
Default value is "bonferroni", which makes the bonferroni correction taking into account the number of tests</p>
            </div>
          </td>
          <td>
                <code>&#39;bonferroni&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mercury.monitoring.drift.chi2_drift_detector</span> <span class="kn">import</span> <span class="n">Chi2Drift</span>
<span class="c1"># Create example distributions</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">histograms_src</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">])]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">histograms_target</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span>
<span class="c1"># Calculate drift</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span> <span class="o">=</span> <span class="n">Chi2Drift</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">distr_src</span><span class="o">=</span><span class="n">histograms_src</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="n">histograms_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;f2&quot;</span><span class="p">],</span>
<span class="o">...</span>     <span class="n">correction</span><span class="o">=</span><span class="s2">&quot;bonferroni&quot;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_metrics</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">calculate_drift</span><span class="p">()</span>
<span class="c1"># Print the metrics</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Drift Score: &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is drift detected? &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;drift_detected&quot;</span><span class="p">])</span>
<span class="c1"># Plot feature drift scores</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">plot_feature_drift_scores</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># Get drifted features</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">drift_detector</span><span class="o">.</span><span class="n">get_drifted_features</span><span class="p">())</span>
<span class="c1"># Plot histograms of drifted features</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">plot_histograms_drifted_features</span><span class="p">()</span>
</code></pre></div>
</details>

          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/chi2_drift_detector.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distr_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s2">&quot;bonferroni&quot;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">distr_src</span><span class="o">=</span><span class="n">distr_src</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="n">distr_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="n">p_val</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.chi2_drift_detector.Chi2Drift.calculate_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">calculate_drift</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Computes drift by performing a chi-square test of independence between the source dataset distributions
<code>distr_src</code> and the target dataset distributions <code>distr_target</code>. It performs the test individually for each
feature and obtains the p-values and the value of the statistic for each.
The returned dictionary contains the next metrics:</p>
<ul>
<li>p_vals: np.array of the p-values returned by the Chi2 test for each feature.</li>
<li>scores: np.array of the chi2 statistics for each feature.</li>
<li>score: average of all the scores.</li>
<li>drift_detected: final decision if drift is detected. If any of the p-values of the features is lower than
    the threshold, then this is set to 1. Otherwise is 0. This will depend on the specified <code>p_val</code> and
    <code>correction</code> values.</li>
<li>threshold: final threshold applied to decide if drift is detected. It depends on the specified
    <code>p_val</code> and <code>correction</code> values.</li>
</ul>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary with the drift metrics as specified.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/chi2_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes drift by performing a chi-square test of independence between the source dataset distributions</span>
<span class="sd">    `distr_src` and the target dataset distributions `distr_target`. It performs the test individually for each</span>
<span class="sd">    feature and obtains the p-values and the value of the statistic for each.</span>
<span class="sd">    The returned dictionary contains the next metrics:</span>

<span class="sd">    - p_vals: np.array of the p-values returned by the Chi2 test for each feature.</span>
<span class="sd">    - scores: np.array of the chi2 statistics for each feature.</span>
<span class="sd">    - score: average of all the scores.</span>
<span class="sd">    - drift_detected: final decision if drift is detected. If any of the p-values of the features is lower than</span>
<span class="sd">        the threshold, then this is set to 1. Otherwise is 0. This will depend on the specified `p_val` and</span>
<span class="sd">        `correction` values.</span>
<span class="sd">    - threshold: final threshold applied to decide if drift is detected. It depends on the specified</span>
<span class="sd">        `p_val` and `correction` values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): Dictionary with the drift metrics as specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">p_vals_test</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_chi2</span><span class="p">()</span>
    <span class="n">drift_pred</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_correction</span><span class="p">(</span><span class="n">p_vals_test</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;p_vals&quot;</span><span class="p">:</span> <span class="n">p_vals_test</span><span class="p">,</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span>
        <span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="n">distances</span><span class="p">,</span>
        <span class="s2">&quot;drift_detected&quot;</span><span class="p">:</span> <span class="n">drift_pred</span><span class="p">,</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.density_drift_detector" class="doc doc-heading">
          <code>density_drift_detector</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.density_drift_detector.DensityDriftDetector" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">DensityDriftDetector</span><span class="p">(</span><span class="n">embedding_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vae</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decoder</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">

  
      <p>This detector calculates the "probability" of a particular sample of being an anomaly (or
presenting drift) with respect to a source reference dataset.</p>
<p>This detector works using a VAE for building embeddings of the input data. Then, with those
source embeddings, the density is estimated in such a way that zones in the embeddings space
with lots of samples have high density whereas zones with low density represent "less"
probable samples.</p>
<p>After having trained the detector it can be used for checking whether a particular (new) sample
is an anomaly.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>embedding_dim</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>embedding dimensionality for the VAE (if no <code>vae</code> provided)</p>
            </div>
          </td>
          <td>
                <code>2</code>
          </td>
        </tr>
        <tr>
          <td><code>vae</code></td>
          <td>
                <code>tf.<span title="tf.keras">keras</span>.<span title="tf.keras.Model">Model</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional VAE architecture</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>encoder</code></td>
          <td>
                <code>tf.<span title="tf.keras">keras</span>.<span title="tf.keras.Model">Model</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>encoder part from <code>vae</code></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>decoder</code></td>
          <td>
                <code>tf.<span title="tf.keras">keras</span>.<span title="tf.keras.Model">Model</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>decoder part from <code>vae</code></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mercury.monitoring.drift.density_drift_detector</span> <span class="kn">import</span> <span class="n">DensityDriftDetector</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">detector</span> <span class="o">=</span> <span class="n">DensityDriftDetector</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_source</span><span class="p">)</span>
</code></pre></div>
</details>

          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/density_drift_detector.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">embedding_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">vae</span><span class="p">:</span> <span class="s2">&quot;tf.keras.Model&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
    <span class="n">encoder</span><span class="p">:</span> <span class="s2">&quot;tf.keras.Model&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
    <span class="n">decoder</span><span class="p">:</span> <span class="s2">&quot;tf.keras.Model&quot;</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># noqa: F821</span>
<span class="p">):</span>

    <span class="k">if</span> <span class="n">encoder</span> <span class="ow">or</span> <span class="n">decoder</span> <span class="ow">or</span> <span class="n">vae</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">vae</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All of vae, encoder and decoder must be defined.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">vae</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">vae</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vae</span> <span class="k">else</span> <span class="n">embedding_dim</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.explain" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">explain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ref_point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Explains what features have to change in a certain sample (or batch of samples)
x so it becomes a <code>ref_point</code> in the embedding space. You can use this mehod when
you have "anomalies" and what to check what feeatures need to change for the point
to be an inlier.</p>
<p>If <code>ref_point</code> is None, the considered reference point will be the point in the
embedding space with highest density (i.e. the most normal one).</p>
<p>The returned explanation will be an array with dim(explanation) = dim(x) in which
each item points the direction and amount each feature needs to change (also known
as delta).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>datapoint (or batch of datapoints) to explain</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_point</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference point coords in the embedding space</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>numpy array(s) with explanation(s) per item.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/density_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ref_point</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Explains what features have to change in a certain sample (or batch of samples)</span>
<span class="sd">    x so it becomes a `ref_point` in the embedding space. You can use this mehod when</span>
<span class="sd">    you have &quot;anomalies&quot; and what to check what feeatures need to change for the point</span>
<span class="sd">    to be an inlier.</span>

<span class="sd">    If `ref_point` is None, the considered reference point will be the point in the</span>
<span class="sd">    embedding space with highest density (i.e. the most normal one).</span>

<span class="sd">    The returned explanation will be an array with dim(explanation) = dim(x) in which</span>
<span class="sd">    each item points the direction and amount each feature needs to change (also known</span>
<span class="sd">    as delta).</span>

<span class="sd">    Args:</span>
<span class="sd">        x: datapoint (or batch of datapoints) to explain</span>
<span class="sd">        ref_point: Reference point coords in the embedding space</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy array(s) with explanation(s) per item.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_density_point</span> <span class="k">if</span> <span class="n">ref_point</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ref_point</span>
    <span class="n">reconstructed_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">reconstructed_reference</span> <span class="o">-</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">delta</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.fit" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">fit</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Fits the model</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>source</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference dataset</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>epochs</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of epochs to train the model. If None, early stopping will be used.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>batch_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>batch_size</p>
            </div>
          </td>
          <td>
                <code>128</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>self, detector trained</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/density_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;np.ndarray&quot;</span><span class="p">,</span> <span class="s2">&quot;pd.DataFrame&quot;</span><span class="p">],</span>
        <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the model</span>

<span class="sd">    Args:</span>
<span class="sd">        source: Reference dataset</span>
<span class="sd">        epochs: Number of epochs to train the model. If None, early stopping will be used.</span>
<span class="sd">        batch_size: batch_size</span>

<span class="sd">    Returns:</span>
<span class="sd">        self, detector trained</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span>
            <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span>
            <span class="n">min_delta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vae</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vae</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_vae</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">source</span>

    <span class="n">hist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vae</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hist_</span> <span class="o">=</span> <span class="n">hist</span>

    <span class="c1"># fit gaussian kde to embeddings</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">embeddings_nodrift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">embeddings_nodrift</span> <span class="o">=</span> <span class="n">embeddings_nodrift</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="c1"># TODO: Possible future idea -&gt; For more complicated spaces, try IFs / OCSVM</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">embeddings_nodrift</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;silverman&#39;</span><span class="p">)</span>

    <span class="c1"># Train a surroggate for replacing the kde as it can be slow for inference (+ it</span>
    <span class="c1"># stores train datapoints)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_surrogate</span><span class="p">(</span><span class="n">inp_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">covariance</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fit_surrogate</span><span class="p">()</span>

    <span class="c1"># At this point we could actually delete self.kde</span>
    <span class="c1"># del(self.kde)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.predict" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Predicts the "probability" of each sample in X being an inlier. That is, its similarity
to the reference points seen during training.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dataset</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>numpy array with densities</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/density_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predicts the &quot;probability&quot; of each sample in X being an inlier. That is, its similarity</span>
<span class="sd">    to the reference points seen during training.</span>

<span class="sd">    Args:</span>
<span class="sd">        X: dataset</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy array with densities</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_embeddings</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">densities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">densities</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.density_drift_detector.DensityDriftDetector.predict_embeddings" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">predict_embeddings</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the embeddings predicted by the VAE's encoder.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>target</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dataset</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>numpy array with embeddings</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/density_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the embeddings predicted by the VAE&#39;s encoder.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: dataset</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy array with embeddings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">target</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.domain_classifier_drift_detector" class="doc doc-heading">
          <code>domain_classifier_drift_detector</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.domain_classifier_drift_detector.DomainClassifierDrift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">DomainClassifierDrift</span><span class="p">(</span><span class="n">X_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.base.BaseBatchDriftDetector" href="#mercury.monitoring.drift.base.BaseBatchDriftDetector">BaseBatchDriftDetector</a></code></p>

  
      <p>This class is a drift detector that allows us to train a classifier (Random Forest) to distinguish between a
source dataset <code>X_src</code> and a target dataset <code>X_target</code>. The source and target datasets are specified when creating
the object together with other available parameters. Then the method <code>calculate_drift()</code> is used to obtain a dict
of metrics.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X_src</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source dataset.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>X_target</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target dataset.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the features of <code>X_src</code> and <code>X_target</code>.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>p_val</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Threshold to be used with the p-value obtained to decide if there is drift or not (affects
<code>drift_detected</code> metric when calling <code>calculate_drift()</code>)
Lower values will be more conservative when indicating that drift exists in the dataset.
Default value is 0.05.</p>
            </div>
          </td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>test_size</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When training the domain classifier, this parameter indicates the size of the test set of the domain
classifier. Since the metric <code>drift_score</code> is the auc of this test size, the drift_score won't be very
accurate if the test_size is too small. Default value is 0.3</p>
            </div>
          </td>
          <td>
                <code>0.3</code>
          </td>
        </tr>
        <tr>
          <td><code>n_runs</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This is the number of times that the domain classifier is trained with different splits. The returned
metrics correspond to the averages of different runs. A higher number of runs will produce more accurate
metrics, but it will be computationally more expensive.</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>alpha</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This parameter impacts directly to the false drift detection rate. Concretely, it specifies how much better
the AUC of the domain classifier has to be than 0.5 (as a random classifier) to consider that successfully
distinguishes samples from the source dataset and target dataset. Increasing the value will be more
conservative when detecting drift, so it will lower the false positive detection rate. However, higher
values also can miss true drift detection. Default value is 0.025 which in general a good trade-off.</p>
            </div>
          </td>
          <td>
                <code>0.025</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The rest of the parameters will be used in the Random forest trained as domain classifier. If not specified,
then the default parameters will be used.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mercury.monitoring.drift.domain_classifier_drift</span> <span class="kn">import</span> <span class="n">DomainClassifierDrift</span>
<span class="c1"># Create example datasets</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># Calculate drift</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span> <span class="o">=</span> <span class="n">DomainClassifierDrift</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">X_src</span><span class="p">,</span> <span class="n">X_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;f2&quot;</span><span class="p">],</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_metrics</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">calculate_drift</span><span class="p">()</span>
<span class="c1"># Print the metrics</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Drift Score: &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p_val: &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is drift detected? &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;drift_detected&quot;</span><span class="p">])</span>
<span class="c1"># Get drift scores per feature</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">plot_feature_drift_scores</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>
</details>

          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/domain_classifier_drift_detector.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">X_src</span><span class="o">=</span><span class="n">X_src</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="n">X_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="n">p_val</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="n">n_runs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.domain_classifier_drift_detector.DomainClassifierDrift.calculate_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">calculate_drift</span><span class="p">(</span><span class="n">return_drift_score_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Calculates the drift metrics. The returned drift metrics are in a dictionary with the next keys:</p>
<ul>
<li>drift_detected: indicates if drift is detected or not, comparing the indicated <code>p_val</code> and the obtained
    p-value. The obtained p-value is based on a binomial test that takes into account the number of times
    that the AUC of the domain classifier was higher than random guesses.</li>
<li>drift_score: this is the average AUC obtained by the domain classifier over the different runs.</li>
</ul>
<p>If the parameter <code>return_drift_score_target</code> is True, then it also returns a dataframe with a drift score for
each sample in the target dataset. This score is the predicted probability by the domain classifier and can
help to detect the drifted samples.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>return_drift_score_target</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Indicates if additionally return a dataframe with a drift score for each sample in the target dataset</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary with the drift metrics. If parameter <code>return_drift_score_target</code> is set to True, then it also</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>returns a dataframe with the drift scores for the target dataset.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/domain_classifier_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_drift_score_target</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the drift metrics. The returned drift metrics are in a dictionary with the next keys:</span>

<span class="sd">    - drift_detected: indicates if drift is detected or not, comparing the indicated `p_val` and the obtained</span>
<span class="sd">        p-value. The obtained p-value is based on a binomial test that takes into account the number of times</span>
<span class="sd">        that the AUC of the domain classifier was higher than random guesses.</span>
<span class="sd">    - drift_score: this is the average AUC obtained by the domain classifier over the different runs.</span>

<span class="sd">    If the parameter `return_drift_score_target` is True, then it also returns a dataframe with a drift score for</span>
<span class="sd">    each sample in the target dataset. This score is the predicted probability by the domain classifier and can</span>
<span class="sd">    help to detect the drifted samples.</span>

<span class="sd">    Args:</span>
<span class="sd">        return_drift_score_target (boolean):</span>
<span class="sd">            Indicates if additionally return a dataframe with a drift score for each sample in the target dataset</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): Dictionary with the drift metrics. If parameter `return_drift_score_target` is set to True, then it also</span>
<span class="sd">        returns a dataframe with the drift scores for the target dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">metrics_domain_classifier</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X_target_hat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_runs</span><span class="p">):</span>
        <span class="n">m_domain_classifier</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_domain_classifier</span><span class="p">(</span><span class="n">test_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_size</span><span class="p">)</span>
        <span class="n">metrics_domain_classifier</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_domain_classifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_drift_score_target</span><span class="p">:</span>
            <span class="n">X_target_hat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_target</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_domain_classifier_metrics</span><span class="p">(</span><span class="n">metrics_domain_classifier</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;drift_detected&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_val</span>
    <span class="k">if</span> <span class="n">return_drift_score_target</span><span class="p">:</span>
        <span class="n">df_drift_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_target</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
        <span class="n">df_drift_scores</span><span class="p">[</span><span class="s2">&quot;drift_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_target_hat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span><span class="p">,</span> <span class="n">df_drift_scores</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.drift_simulation" class="doc doc-heading">
          <code>drift_simulation</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">BatchDriftGenerator</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">

  
      <p>This is a simulator for applying synthetic perturbations to a given dataset,
so real life drift situations can be generated.</p>
<p>It allows generating several typical drift-like perturbations. In particular, it has the</p>

<details class="following-ones-implemented" open>
  <summary>following ones implemented</summary>
  <p>1) Shift drift: Each one of the numerical features will be shifted by an amount N. With this,
you will be able to simulate situations where a particular feature increases of decreases.
2) Recodification drift: This operations simulates the situation where a particular feature
changes its codification (due to some change in a data ingestion pipeline). For example, imagine
a feature codified as [A, B, C] and, for some reason, category "C" becomes "A" and vice versa.
3) Missing value drift: Artificially increases the percentage of NaNs on a given feature or
list of features.
4) Hyperplane rotation drift: This method operates by modifying a set of features at once but
attempting to preserve the relationships they have. In other terms, it tries to change the
joint distribution of N continuous variables at once.
5) Outliers drift: This method artificially introduces outliers in the specified columns. You
can use one of the existing methods to inject outliers or create your own method. Check the
method documentation for <code>outliers_drift</code> for further documentation</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataset features</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>names_categorical</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional list with the names of the categorical variables. If given,</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">schema</span><span class="p">:</span> <span class="n">DataSchema</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">schema</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.__get_rotation_matrix" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">__get_rotation_matrix</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns a rotation matrix for a R^n space.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>n</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dimensionality of the space</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>deg</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>amount of rotation to be applied. In degrees.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>nxn dimensional rotation matrix</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__get_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns a rotation matrix for a R^n space.</span>

<span class="sd">    Args:</span>
<span class="sd">        n: Dimensionality of the space</span>
<span class="sd">        deg: amount of rotation to be applied. In degrees.</span>

<span class="sd">    Returns:</span>
<span class="sd">        nxn dimensional rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># https://en.wikipedia.org/wiki/Orthogonal_matrix#:~:text=Canonical%20form%5Bedit%5D</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">deg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">rot</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">rot</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">rot</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">rot</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">rot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">rot</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.__remap_categorical" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">__remap_categorical</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Randomly shuffles the categories of a particular column</p>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__remap_categorical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">colname</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Randomly shuffles the categories of a particular column</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">original_ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">remaped_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">original_ids</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">remaped_ids</span><span class="p">)</span>
    <span class="n">remap_dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">original_ids</span><span class="p">,</span> <span class="n">remaped_ids</span><span class="p">)}</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">remap_dic</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.hyperplane_rotation_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">hyperplane_rotation_drift</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Adds drift to several features at once by rotating them.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cols</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>columns which will be jointly rotated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>force</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>rotation amount in degrees (0 or 360 = no transformation)</p>
            </div>
          </td>
          <td>
                <code>10.0</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator">BatchDriftGenerator</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An updated version of the simulator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hyperplane_rotation_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BatchDriftGenerator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Adds drift to several features at once by rotating them.</span>

<span class="sd">    Args:</span>
<span class="sd">        cols: columns which will be jointly rotated.</span>
<span class="sd">        force: rotation amount in degrees (0 or 360 = no transformation)</span>
<span class="sd">    Returns:</span>
<span class="sd">        An updated version of the simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">force</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">continuous_feats</span> <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cols</span>
    <span class="n">rotmat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_rotation_matrix</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">),</span> <span class="n">force</span><span class="p">)</span>
    <span class="c1"># Rows with NaNs wont receive the transformation</span>
    <span class="n">nan_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">nan_entries</span><span class="p">,</span> <span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">nan_entries</span><span class="p">,</span> <span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">@</span> <span class="n">rotmat</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.missing_val_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">missing_val_drift</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Randomly injects NaN values in a column.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cols</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Columns where this operation will be performed</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>percent</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[float, <span title="typing.List">List</span>[float]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Percentage of values which will become Null values.</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator">BatchDriftGenerator</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An updated version of the simulator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">missing_val_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">percent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BatchDriftGenerator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Randomly injects NaN values in a column.</span>

<span class="sd">    Args:</span>
<span class="sd">        cols: Columns where this operation will be performed</span>
<span class="sd">        percent: Percentage of values which will become Null values.</span>
<span class="sd">    Returns:</span>
<span class="sd">        An updated version of the simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">percent</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If both cols and percent are lists, they must have the same size.&quot;</span><span class="p">)</span>

    <span class="n">drifted_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">drifted_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cols</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">percent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="n">percent</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">p</span>
        <span class="n">drifted_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.outliers_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">outliers_drift</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="n">method_params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Injects outliers in <code>cols</code> using the method specified in <code>method</code>. Parameters of the method can
be specified using <code>method_params</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cols</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of columns names to generate outliers.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="typing.Callable">Callable</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>string of the method to generate to use or custom function to generate outliers. If
using string, the current available method are 'percentile' and 'value'. If using 'percentile'
values in the dataframe are replaced by a percentile of that column. The percentile to use is
specified in key 'percentile' in <code>method_params</code> dictionary, and the key 'proportion_outliers'
specifies the proportion of outliers to set in the column. If using 'value', a custom value is
set in the column. The value is specified with the key 'value' in <code>method_params</code> and the
key <code>proportion_outliers</code> specifies the proportion of outliers to set in the column.
When using a custom function, the interface that should follow is
<code>fn(X: np.array, params: dict = None)</code>, where <code>X</code> will be an array of shape==1 to apply
the outlier generation and <code>params</code> is the dictionary where parameters of the method
are passed.</p>
            </div>
          </td>
          <td>
                <code>&#39;percentile&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>method_params</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary containing the parameters to use in <code>method</code></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator">BatchDriftGenerator</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An updated version of the simulator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">outliers_drift</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;percentile&quot;</span><span class="p">,</span> <span class="n">method_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BatchDriftGenerator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Injects outliers in `cols` using the method specified in `method`. Parameters of the method can</span>
<span class="sd">    be specified using `method_params`.</span>

<span class="sd">    Args:</span>
<span class="sd">          cols: List of columns names to generate outliers.</span>
<span class="sd">          method: string of the method to generate to use or custom function to generate outliers. If</span>
<span class="sd">            using string, the current available method are &#39;percentile&#39; and &#39;value&#39;. If using &#39;percentile&#39;</span>
<span class="sd">            values in the dataframe are replaced by a percentile of that column. The percentile to use is</span>
<span class="sd">            specified in key &#39;percentile&#39; in `method_params` dictionary, and the key &#39;proportion_outliers&#39;</span>
<span class="sd">            specifies the proportion of outliers to set in the column. If using &#39;value&#39;, a custom value is</span>
<span class="sd">            set in the column. The value is specified with the key &#39;value&#39; in `method_params` and the</span>
<span class="sd">            key `proportion_outliers` specifies the proportion of outliers to set in the column.</span>
<span class="sd">            When using a custom function, the interface that should follow is</span>
<span class="sd">            `fn(X: np.array, params: dict = None)`, where `X` will be an array of shape==1 to apply</span>
<span class="sd">            the outlier generation and `params` is the dictionary where parameters of the method</span>
<span class="sd">            are passed.</span>
<span class="sd">          method_params: dictionary containing the parameters to use in `method`</span>

<span class="sd">    Returns:</span>
<span class="sd">        An updated version of the simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drifted_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>

    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">continuous_feats</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">discrete_feats</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">Callable</span><span class="p">):</span>
        <span class="n">generate_outliers_fn</span> <span class="o">=</span> <span class="n">method</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">generate_outliers_fn</span> <span class="o">=</span> <span class="n">_get_outlier_generation_fn</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="n">outliers</span> <span class="o">=</span> <span class="n">generate_outliers_fn</span><span class="p">(</span><span class="n">drifted_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method_params</span><span class="p">)</span>
        <span class="n">drifted_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">outliers</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.recodification_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">recodification_drift</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Adds drift by randomly remapping the categories of cols.
For example, if you have a column with domain: ["A", "B", "C"], then, this
operation would swap all the "A" with "C" (and vice versa).</p>
<p>Note the swaps are random. The same remapping will not be repeated.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cols</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of columns names to be recoded</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator">BatchDriftGenerator</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An updated version of the simulator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">recodification_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BatchDriftGenerator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Adds drift by randomly remapping the categories of cols.</span>
<span class="sd">    For example, if you have a column with domain: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], then, this</span>
<span class="sd">    operation would swap all the &quot;A&quot; with &quot;C&quot; (and vice versa).</span>

<span class="sd">    Note the swaps are random. The same remapping will not be repeated.</span>

<span class="sd">    Args:</span>
<span class="sd">          cols: List of columns names to be recoded</span>

<span class="sd">    Returns:</span>
<span class="sd">        An updated version of the simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drifted_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">categorical_feats</span> <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cols</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__remap_categorical</span><span class="p">(</span><span class="n">drifted_df</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.scale_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">scale_drift</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">iqr</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Adds drift to one or several features by multiplying then by some
random factor (normally close to 1).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cols</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of columns names where the operation will be performed</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>mean</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mean value of the random scale (if iqr is not given). Default is 1.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>sd</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The standard deviation of the random scale (if iqr is not given). Default is 0.05.</p>
            </div>
          </td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>iqr</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An alternative way to define the random scale is by giving the interquartile range as
a list of 2 elements. E.g. [1, 1.2]</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator">BatchDriftGenerator</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An updated version of the simulator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">scale_drift</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">iqr</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BatchDriftGenerator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds drift to one or several features by multiplying then by some</span>
<span class="sd">    random factor (normally close to 1).</span>

<span class="sd">    Args:</span>
<span class="sd">        cols: List of columns names where the operation will be performed</span>
<span class="sd">        mean: The mean value of the random scale (if iqr is not given). Default is 1.</span>
<span class="sd">        sd: The standard deviation of the random scale (if iqr is not given). Default is 0.05.</span>
<span class="sd">        iqr: An alternative way to define the random scale is by giving the interquartile range as</span>
<span class="sd">            a list of 2 elements. E.g. [1, 1.2]</span>

<span class="sd">    Returns:</span>
<span class="sd">        An updated version of the simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">iqr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># q1, q3 = mean +/- .67449*sd</span>
        <span class="n">q1</span><span class="p">,</span> <span class="n">q3</span> <span class="o">=</span> <span class="n">iqr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iqr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.34898</span>

    <span class="n">drifted_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>

    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">continuous_feats</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drifted_df</span><span class="p">))</span>
        <span class="n">drifted_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator.shift_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">shift_drift</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Adds drift to one or several features by adding or substracting a <code>force</code>
quantity. You could also add random noise to these shifts via the <code>noise</code>
parameter. The shifted amount will follow a gaussian distribution with mean
<code>force</code> and std <code>noise</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cols</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of columns names where the operation will be performed</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>force</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Amount shift each column will receive</p>
            </div>
          </td>
          <td>
                <code>5.0</code>
          </td>
        </tr>
        <tr>
          <td><code>noise</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Amount of standard deviation the shift of each column will receive.</p>
            </div>
          </td>
          <td>
                <code>0.0</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.drift_simulation.BatchDriftGenerator" href="#mercury.monitoring.drift.drift_simulation.BatchDriftGenerator">BatchDriftGenerator</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An updated version of the simulator.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/drift_simulation.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">shift_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BatchDriftGenerator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Adds drift to one or several features by adding or substracting a `force`</span>
<span class="sd">    quantity. You could also add random noise to these shifts via the `noise`</span>
<span class="sd">    parameter. The shifted amount will follow a gaussian distribution with mean</span>
<span class="sd">    `force` and std `noise`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cols: List of columns names where the operation will be performed</span>
<span class="sd">        force: Amount shift each column will receive</span>
<span class="sd">        noise: Amount of standard deviation the shift of each column will receive.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An updated version of the simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drifted_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">continuous_feats</span> <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cols</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">force</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">force</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="n">force</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">noise</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="n">noise</span>
        <span class="n">shifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">drifted_df</span><span class="p">))</span>
        <span class="n">drifted_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shifts</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.histogram_distance_drift_detector" class="doc doc-heading">
          <code>histogram_distance_drift_detector</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.histogram_distance_drift_detector.HistogramDistanceDrift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">HistogramDistanceDrift</span><span class="p">(</span><span class="n">distr_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_permutations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">distance_metric</span><span class="o">=</span><span class="s1">&#39;hellinger&#39;</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.base.BaseBatchDriftDetector" href="#mercury.monitoring.drift.base.BaseBatchDriftDetector">BaseBatchDriftDetector</a></code></p>

  
      <p>The HistogramDistanceDrift class allows us to detect drift in the source dataset distributions <code>distr_src</code> and the
target dataset distributions <code>distr_target</code> by calculating distances between the distributions. For each feature,
the distance between its distributions in <code>distr_src</code> and <code>distr_target</code> is calculated. The distance function to
use is indicated by the <code>distance_metric</code> parameter. For each feature, a p-value is also calculated. This is
calculated by doing a permutation test, where data from <code>distr_src</code> and <code>distr_target</code> are put together and sampled
to calculate a new simulated distance <code>n_permutations</code> times. The p-value then is obtained by computing
the fraction of simulated distances equal or greater than the observed distance. The source and target distributions
are specified when creating the object. Then, the method <code>calculate_drift()</code> is used to obtain a dict of metrics.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>distr_src</code></td>
          <td>
                <code>list of np.arrays</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source dataset distributions. It's a list of np.arrays, where each np.array represents the counts of
each bin for that feature. The features and its bins must be in the same order than the <code>distr_target</code></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>distr_target</code></td>
          <td>
                <code>list of np.arrays</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target dataset distributions. It's a list of np.arrays, where each np.array represents the counts of
each bin for that feature. The features and its bins must be in the same order than the <code>distr_src</code></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the features of <code>X_src</code> and <code>X_target</code>.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>distance_metric</code></td>
          <td>
                <code>string</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The distance metric to use. Available metrics are "hellinger", "jeffreys" or "psi".
Default value is "hellinger"</p>
            </div>
          </td>
          <td>
                <code>&#39;hellinger&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>p_val</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Threshold to be used with the p-value obtained to decide if there is drift or not (affects
<code>drift_detected</code> metric when calling <code>calculate_drift()</code>)
Lower values will be more conservative when indicating that drift exists in the dataset.
Default value is 0.05.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>correction</code></td>
          <td>
                <code>string</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Since multiple tests are performed, this parameter controls whether to perform a correction of the p-value
or not (affects <code>drift_detected</code> metric when calling <code>calculate_drift()</code>). If None, it doesn't perform
a correction
Default value is "bonferroni", which makes the bonferroni correction taking into account the number of tests</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>n_permutations</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of permutations to perform to calculate the p-value. A higher number will calculate a more
accurate p-value, but it will be computationally more expensive.
Default value is 50</p>
            </div>
          </td>
          <td>
                <code>50</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mercury.monitoring.drift.histogram_distance_drift_detector</span> <span class="kn">import</span> <span class="n">HistogramDistanceDrift</span>
<span class="c1"># Create example distributions</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">histograms_src</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">])]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">histograms_target</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span>
<span class="c1"># Calculate drift</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span> <span class="o">=</span> <span class="n">HistogramDistanceDrift</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">distr_src</span><span class="o">=</span><span class="n">histograms_src</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="n">histograms_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;f2&quot;</span><span class="p">],</span>
<span class="o">...</span>     <span class="n">distance_metric</span><span class="o">=</span><span class="s2">&quot;hellinger&quot;</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s2">&quot;bonferroni&quot;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">n_permutations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_metrics</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">calculate_drift</span><span class="p">()</span>
<span class="c1"># Print the metrics</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Drift Score: &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is drift detected? &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;drift_detected&quot;</span><span class="p">])</span>
<span class="c1"># Plot feature drift scores</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">plot_feature_drift_scores</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># Get drifted features</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">drift_detector</span><span class="o">.</span><span class="n">get_drifted_features</span><span class="p">())</span>
<span class="c1"># Plot histograms of drifted features</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">plot_histograms_drifted_features</span><span class="p">()</span>
</code></pre></div>
</details>

          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/histogram_distance_drift_detector.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">distr_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">correction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_permutations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">distance_metric</span><span class="o">=</span><span class="s2">&quot;hellinger&quot;</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">distr_src</span><span class="o">=</span><span class="n">distr_src</span><span class="p">,</span> <span class="n">distr_target</span><span class="o">=</span><span class="n">distr_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="n">p_val</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_permutations</span> <span class="o">=</span> <span class="n">n_permutations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distance_metric</span> <span class="o">=</span> <span class="n">distance_metric</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.histogram_distance_drift_detector.HistogramDistanceDrift.calculate_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">calculate_drift</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Computes drift by calculating histogram-based distances between the source dataset distributions <code>distr_src</code>
and the target dataset distributions <code>distr_target</code>. It calculates the distance individually for each feature
and obtains the p-values and distance for each.
The returned dictionary contains the next metrics:</p>
<ul>
<li>p_vals: np.array of the p-values returned by the permutation test for each feature.</li>
<li>scores: np.array of the distances for each feature.</li>
<li>score: average of all the distances.</li>
<li>drift_detected: final decision if drift is detected. If any of the p-values of the features is lower than
    the threshold, then this is set to 1. Otherwise is 0. This will depend on the specified <code>p_val</code> and
    <code>correction</code> values.</li>
<li>threshold: final threshold applied to decide if drift is detected. It depends on the specified
    <code>p_val</code> and <code>correction</code> values.</li>
</ul>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary with the drift metrics as specified.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/histogram_distance_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes drift by calculating histogram-based distances between the source dataset distributions `distr_src`</span>
<span class="sd">    and the target dataset distributions `distr_target`. It calculates the distance individually for each feature</span>
<span class="sd">    and obtains the p-values and distance for each.</span>
<span class="sd">    The returned dictionary contains the next metrics:</span>

<span class="sd">    - p_vals: np.array of the p-values returned by the permutation test for each feature.</span>
<span class="sd">    - scores: np.array of the distances for each feature.</span>
<span class="sd">    - score: average of all the distances.</span>
<span class="sd">    - drift_detected: final decision if drift is detected. If any of the p-values of the features is lower than</span>
<span class="sd">        the threshold, then this is set to 1. Otherwise is 0. This will depend on the specified `p_val` and</span>
<span class="sd">        `correction` values.</span>
<span class="sd">    - threshold: final threshold applied to decide if drift is detected. It depends on the specified</span>
<span class="sd">        `p_val` and `correction` values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): Dictionary with the drift metrics as specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_vals_estimated</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_histogram_distance</span><span class="p">()</span>
    <span class="n">drift_pred</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_correction</span><span class="p">(</span><span class="n">p_vals_estimated</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;p_vals&quot;</span><span class="p">:</span> <span class="n">p_vals_estimated</span><span class="p">,</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span>
        <span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="n">distances</span><span class="p">,</span>
        <span class="s2">&quot;drift_detected&quot;</span><span class="p">:</span> <span class="n">drift_pred</span><span class="p">,</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.ks_drift_detector" class="doc doc-heading">
          <code>ks_drift_detector</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="mercury.monitoring.drift.ks_drift_detector.KSDrift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">KSDrift</span><span class="p">(</span><span class="n">X_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="mercury.monitoring.drift.base.BaseBatchDriftDetector" href="#mercury.monitoring.drift.base.BaseBatchDriftDetector">BaseBatchDriftDetector</a></code></p>

  
      <p>This class is a drift detector that allows us to detect drift in a source dataset <code>X_src</code> and a target dataset
<code>X_target</code> by calculating the Kolmogorov-Smirnov (KS) statistic. For each feature in the datasets, a
Kolmogorov-Smirnov test is performed, which calculates the distance between the feature using the samples of each
dataset. A p-value is also obtained when performing the tests, which are used to decide if exists drift in the
datasets. The source and target datasets are specified when creating the object together with other available
parameters. Then the method <code>calculate_drift()</code> is used to obtain a dict of metrics.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X_src</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source dataset.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>X_target</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target dataset.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the features of <code>X_src</code> and <code>X_target</code>.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>p_val</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Threshold to be used with the p-value obtained to decide if there is drift or not (affects
<code>drift_detected</code> metric when calling <code>calculate_drift()</code>).
Lower values will be more conservative when indicating that drift exists in the dataset.
Default value is 0.05.</p>
            </div>
          </td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>correction</code></td>
          <td>
                <code>string</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Since multiple tests are performed, this parameter controls whether to perform a correction of the p-value
or not (affects <code>drift_detected</code> metric when calling <code>calculate_drift()</code>). If None, it doesn't perform
a correction
Default value is "bonferroni", which makes the bonferroni correction taking into account the number of tests</p>
            </div>
          </td>
          <td>
                <code>&#39;bonferroni&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mercury.monitoring.drift.ks_drift_detector</span> <span class="kn">import</span> <span class="n">KSDrift</span>
<span class="c1"># Create example datasets</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># Calculate drift</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span> <span class="o">=</span> <span class="n">KSDrift</span><span class="p">(</span><span class="n">X_src</span><span class="p">,</span> <span class="n">X_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;f2&quot;</span><span class="p">],</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s2">&quot;bonferroni&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_metrics</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">calculate_drift</span><span class="p">()</span>
<span class="c1"># Print the metrics</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Drift Score: &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is drift detected? &quot;</span><span class="p">,</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;drift_detected&quot;</span><span class="p">])</span>
<span class="c1"># Plot feature drift scoress</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">plot_feature_drift_scores</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># Get drifted features</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">drift_detector</span><span class="o">.</span><span class="n">get_drifted_features</span><span class="p">())</span>
<span class="c1"># Plot distributions of drifted features</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">plot_distribution_drifted_features</span><span class="p">()</span>
</code></pre></div>
</details>

          <details class="quote">
            <summary>Source code in <code>mercury/monitoring/drift/ks_drift_detector.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s2">&quot;bonferroni&quot;</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">X_src</span><span class="o">=</span><span class="n">X_src</span><span class="p">,</span> <span class="n">X_target</span><span class="o">=</span><span class="n">X_target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="n">p_val</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="mercury.monitoring.drift.ks_drift_detector.KSDrift.calculate_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">calculate_drift</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Computes Drift using the Kolmogorov-Smirnov KS Test, which calculates the largest difference of the cumulative
density functions of two variables.
It performs the test individually for each feature and obtains the p-values and the statistics for each feature.
The returned dictionary contains the next metrics:</p>
<ul>
<li>p_vals (np.array): the p-values returned by the KS test for each feature.</li>
<li>scores (np.array): the distances (ks statistic) return by the KS test for each feature.</li>
<li>score: average of all the distances.</li>
<li>drift_detected: final decision if drift is detected. If any of the p-values of the features is lower than
    the threshold, then this is set to 1. Otherwise is 0. This will depend on the specified <code>p_val</code> and
    <code>correction</code> values.</li>
<li>threshold: final threshold applied to decide if drift is detected. It depends on the specified
    <code>p_val</code> and <code>correction</code> values.</li>
</ul>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary with the drift metrics as specified.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/ks_drift_detector.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes Drift using the Kolmogorov-Smirnov KS Test, which calculates the largest difference of the cumulative</span>
<span class="sd">    density functions of two variables.</span>
<span class="sd">    It performs the test individually for each feature and obtains the p-values and the statistics for each feature.</span>
<span class="sd">    The returned dictionary contains the next metrics:</span>

<span class="sd">    - p_vals (np.array): the p-values returned by the KS test for each feature.</span>
<span class="sd">    - scores (np.array): the distances (ks statistic) return by the KS test for each feature.</span>
<span class="sd">    - score: average of all the distances.</span>
<span class="sd">    - drift_detected: final decision if drift is detected. If any of the p-values of the features is lower than</span>
<span class="sd">        the threshold, then this is set to 1. Otherwise is 0. This will depend on the specified `p_val` and</span>
<span class="sd">        `correction` values.</span>
<span class="sd">    - threshold: final threshold applied to decide if drift is detected. It depends on the specified</span>
<span class="sd">        `p_val` and `correction` values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): Dictionary with the drift metrics as specified.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">p_vals_test</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_ks</span><span class="p">()</span>
    <span class="n">drift_pred</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_correction</span><span class="p">(</span><span class="n">p_vals_test</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;p_vals&quot;</span><span class="p">:</span> <span class="n">p_vals_test</span><span class="p">,</span>
        <span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="n">distances</span><span class="p">,</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span>
        <span class="s2">&quot;drift_detected&quot;</span><span class="p">:</span> <span class="n">drift_pred</span><span class="p">,</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_metrics</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mercury.monitoring.drift.metrics" class="doc doc-heading">
          <code>metrics</code>


</h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="mercury.monitoring.drift.metrics.bootstrap_eval_drift" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">bootstrap_eval_drift</span><span class="p">(</span><span class="n">y_true_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_pred_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_true_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_pred_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eval_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resample_size_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resample_size_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">drift_detector</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>This function performs resampling with replacement for a source set and a target set to obtain
a distribution of some evaluation metric for both sets. Then, applies a drift detector to calculate
the drift of the metric between the source and target sets. More concretely, first performs resampling
with replacement in the arrays <code>y_true_src</code> and <code>y_pred_src</code> and calculates a metric using the
<code>eval_fn</code> function in order to obtain a metric for each resample. Thus, we obtain a distribution of a
metric for the source set. Next, it performs the same procedure with the arrays <code>y_true_target</code> and
<code>y_pred_target</code>, which gives a distribution of the metric for the target dataset. Finally, applies
a drift detector (KSDrift if not specified) in order to calculate the drift between the source and
target obtained distributions.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true_src</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>array which will be the first argument when calling <code>eval_fn</code> for the source
dataset. It can contain the labels of the source dataset if <code>eval_fn</code> is defined to accept
labels as the first argument.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>y_pred_src</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>array which will be the second argument when calling <code>eval_fn</code> for the source
dataset. It can contain the source dataset model predictions if the <code>eval_fn</code> is defined to
accept predictions as the second argument.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>y_true_target</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>array which will the first argument when calling <code>eval_fn</code> for the target
dataset. It can contain the labels of the target dataset if <code>eval_fn</code> is defined to accept
labels as the first argument.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>y_pred_target</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>array which will be the second argument when calling <code>eval_fn</code> for the
target dataset. It can contain the target dataset model predictions if the <code>eval_fn</code> is defined
to accept predictions as the second argument.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>eval_fn</code></td>
          <td>
                <code>Callable</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>function that must return a float. For the source dataset, receives a resamples
of <code>y_true_src</code> as first parameter and resamples of <code>y_pred</code> as second parameter. Similarly, it
uses resamples of <code>y_true_target</code> as first parameter and resamples of <code>y_pred_target</code> as second
parameter for the target dataset. For example, it can be a function that calculates the accuracy
given <code>y_true</code> and <code>y_pred</code>, or it can be a weighted average of different metrics.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>resample_size_src</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>size of each resample for the source dataset. If None, length of the source.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>resample_size_target</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>size of each resample for the target dataset. If None, length of the target.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>num_resamples</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of resamples</p>
            </div>
          </td>
          <td>
                <code>50</code>
          </td>
        </tr>
        <tr>
          <td><code>drift_detector</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>drift detector to use. If None it will create a KSDrift object</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>drift_metrics</code></td>          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary with the obtained drift metrics</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>drift_detector</code></td>          <td>
                <code>BaseBatchDriftDetector</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>drift detector object used to calculate drift</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>dist_src</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>obtained metrics distribution for the source dataset</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>dist_target</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>obtained metrics distribution for the target dataset</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">y_true_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">y_pred_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">y_true_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">y_pred_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">eval_acc</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_true</span> <span class="o">==</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_metrics</span><span class="p">,</span> <span class="n">drift_detector</span><span class="p">,</span> <span class="n">dist_src</span><span class="p">,</span> <span class="n">dist_target</span> <span class="o">=</span> <span class="n">bootstrap_eval_drift</span><span class="p">(</span>
<span class="o">...</span>        <span class="n">y_true_src</span><span class="o">=</span><span class="n">y_true_src</span><span class="p">,</span> <span class="n">y_pred_src</span><span class="o">=</span><span class="n">y_pred_src</span><span class="p">,</span> <span class="n">y_true_target</span><span class="o">=</span><span class="n">y_true_target</span><span class="p">,</span> <span class="n">y_pred_target</span><span class="o">=</span><span class="n">y_pred_target</span><span class="p">,</span>
<span class="o">...</span>        <span class="n">resample_size_src</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">resample_size_target</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="o">...</span>        <span class="n">eval_fn</span><span class="o">=</span><span class="n">eval_acc</span><span class="p">,</span> <span class="n">drift_detector</span><span class="o">=</span><span class="kc">None</span>
<span class="o">...</span>    <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;drift_detected]</span>
<span class="kc">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">drift_metrics</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
<span class="mf">0.943</span>
</code></pre></div>
</details>
      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/metrics.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bootstrap_eval_drift</span><span class="p">(</span>
    <span class="n">y_true_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_pred_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_true_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_pred_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eval_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">resample_size_src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resample_size_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">drift_detector</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function performs resampling with replacement for a source set and a target set to obtain</span>
<span class="sd">    a distribution of some evaluation metric for both sets. Then, applies a drift detector to calculate</span>
<span class="sd">    the drift of the metric between the source and target sets. More concretely, first performs resampling</span>
<span class="sd">    with replacement in the arrays `y_true_src` and `y_pred_src` and calculates a metric using the</span>
<span class="sd">    `eval_fn` function in order to obtain a metric for each resample. Thus, we obtain a distribution of a</span>
<span class="sd">    metric for the source set. Next, it performs the same procedure with the arrays `y_true_target` and</span>
<span class="sd">    `y_pred_target`, which gives a distribution of the metric for the target dataset. Finally, applies</span>
<span class="sd">    a drift detector (KSDrift if not specified) in order to calculate the drift between the source and</span>
<span class="sd">    target obtained distributions.</span>

<span class="sd">    Args:</span>
<span class="sd">        y_true_src (np.array): array which will be the first argument when calling `eval_fn` for the source</span>
<span class="sd">            dataset. It can contain the labels of the source dataset if `eval_fn` is defined to accept</span>
<span class="sd">            labels as the first argument.</span>
<span class="sd">        y_pred_src (np.array): array which will be the second argument when calling `eval_fn` for the source</span>
<span class="sd">            dataset. It can contain the source dataset model predictions if the `eval_fn` is defined to</span>
<span class="sd">            accept predictions as the second argument.</span>
<span class="sd">        y_true_target (np.array): array which will the first argument when calling `eval_fn` for the target</span>
<span class="sd">            dataset. It can contain the labels of the target dataset if `eval_fn` is defined to accept</span>
<span class="sd">            labels as the first argument.</span>
<span class="sd">        y_pred_target (np.array): array which will be the second argument when calling `eval_fn` for the</span>
<span class="sd">            target dataset. It can contain the target dataset model predictions if the `eval_fn` is defined</span>
<span class="sd">            to accept predictions as the second argument.</span>
<span class="sd">        eval_fn (Callable): function that must return a float. For the source dataset, receives a resamples</span>
<span class="sd">            of `y_true_src` as first parameter and resamples of `y_pred` as second parameter. Similarly, it</span>
<span class="sd">            uses resamples of `y_true_target` as first parameter and resamples of `y_pred_target` as second</span>
<span class="sd">            parameter for the target dataset. For example, it can be a function that calculates the accuracy</span>
<span class="sd">            given `y_true` and `y_pred`, or it can be a weighted average of different metrics.</span>
<span class="sd">        resample_size_src (int): size of each resample for the source dataset. If None, length of the source.</span>
<span class="sd">        resample_size_target (int): size of each resample for the target dataset. If None, length of the target.</span>
<span class="sd">        num_resamples (int): number of resamples</span>
<span class="sd">        drift_detector: drift detector to use. If None it will create a KSDrift object</span>

<span class="sd">    Returns:</span>
<span class="sd">            drift_metrics (dict): dictionary with the obtained drift metrics</span>
<span class="sd">            drift_detector (BaseBatchDriftDetector): drift detector object used to calculate drift</span>
<span class="sd">            dist_src (np.array): obtained metrics distribution for the source dataset</span>
<span class="sd">            dist_target (np.array): obtained metrics distribution for the target dataset</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; y_true_src = np.array([0,0,0,0,0,1,1,1,1,1])</span>
<span class="sd">        &gt;&gt;&gt; y_pred_src = np.array([0,0,0,0,1,0,1,1,1,1])</span>
<span class="sd">        &gt;&gt;&gt; y_true_target = np.array([0,0,0,0,0,1,1,1,1,1])</span>
<span class="sd">        &gt;&gt;&gt; y_pred_target = np.array([0,1,1,1,1,0,0,0,0,1])</span>
<span class="sd">        &gt;&gt;&gt; def eval_acc(y_true, y_pred):</span>
<span class="sd">        ...     return np.sum(y_true == y_pred) / y_true.shape[0]</span>

<span class="sd">        &gt;&gt;&gt; drift_metrics, drift_detector, dist_src, dist_target = bootstrap_eval_drift(</span>
<span class="sd">        ...        y_true_src=y_true_src, y_pred_src=y_pred_src, y_true_target=y_true_target, y_pred_target=y_pred_target,</span>
<span class="sd">        ...        resample_size_src=8, resample_size_target=8, num_resamples=1000,</span>
<span class="sd">        ...        eval_fn=eval_acc, drift_detector=None</span>
<span class="sd">        ...    )</span>
<span class="sd">        &gt;&gt;&gt; drift_metrics[&quot;drift_detected]</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; drift_metrics[&quot;score&quot;]</span>
<span class="sd">        0.943</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">resample_size_src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resample_size_src</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true_src</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resample_size_target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resample_size_target</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true_target</span><span class="p">)</span>

    <span class="c1"># Get distributions for source dataset</span>
    <span class="n">dist_src</span> <span class="o">=</span> <span class="n">bootstrap_eval</span><span class="p">(</span><span class="n">y_true_src</span><span class="p">,</span> <span class="n">y_pred_src</span><span class="p">,</span> <span class="n">eval_fn</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">resample_size_src</span><span class="p">)</span>

    <span class="c1"># Get distributions for target dataset</span>
    <span class="n">dist_target</span> <span class="o">=</span> <span class="n">bootstrap_eval</span><span class="p">(</span><span class="n">y_true_target</span><span class="p">,</span> <span class="n">y_pred_target</span><span class="p">,</span> <span class="n">eval_fn</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">resample_size_target</span><span class="p">)</span>

    <span class="c1"># Apply drift detector. If it is not passed, use ks drift</span>
    <span class="k">if</span> <span class="n">drift_detector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">drift_detector</span> <span class="o">=</span> <span class="n">KSDrift</span><span class="p">(</span>
            <span class="n">X_src</span><span class="o">=</span><span class="n">dist_src</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">X_target</span><span class="o">=</span><span class="n">dist_target</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s2">&quot;bonferroni&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">drift_detector</span><span class="o">.</span><span class="n">set_datasets</span><span class="p">(</span><span class="n">X_src</span><span class="o">=</span><span class="n">dist_src</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">X_target</span><span class="o">=</span><span class="n">dist_target</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">drift_metrics</span> <span class="o">=</span> <span class="n">drift_detector</span><span class="o">.</span><span class="n">calculate_drift</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">drift_metrics</span><span class="p">,</span> <span class="n">drift_detector</span><span class="p">,</span> <span class="n">dist_src</span><span class="p">,</span> <span class="n">dist_target</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="mercury.monitoring.drift.metrics.hellinger_distance" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">hellinger_distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Computes Hellinger distance between two histograms as specified in this paper:
http://users.rowan.edu/~polikar/RESEARCH/PUBLICATIONS/cidue11.pdf
Both histograms are represented by numpy arrays with the same number of dimensions,
where each dimension represents the counts for that particular bin.
It is assumed that the bin edges are the same.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>p</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>First histogram. Each dimension represents one bin and bin edges are assumed to be the same as in q.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>q</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Second histogram. Each dimension represents one bin and bin edges are assumed to be the same as in p.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>normalize</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to normalize the histograms. If True the proportions of each bin are calculated first
and then the distance is calculated with the proportions</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>Returns</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(float): float representing the Hellinger distance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/metrics.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hellinger_distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes Hellinger distance between two histograms as specified in this paper:</span>
<span class="sd">    http://users.rowan.edu/~polikar/RESEARCH/PUBLICATIONS/cidue11.pdf</span>
<span class="sd">    Both histograms are represented by numpy arrays with the same number of dimensions,</span>
<span class="sd">    where each dimension represents the counts for that particular bin.</span>
<span class="sd">    It is assumed that the bin edges are the same.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (np.array): First histogram. Each dimension represents one bin and bin edges are assumed to be the same as in q.</span>
<span class="sd">        q (np.array): Second histogram. Each dimension represents one bin and bin edges are assumed to be the same as in p.</span>
<span class="sd">        normalize (bool): Whether to normalize the histograms. If True the proportions of each bin are calculated first</span>
<span class="sd">            and then the distance is calculated with the proportions</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): float representing the Hellinger distance</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;p and q must have the same size and represent the same bins&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">distances</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">distances</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="mercury.monitoring.drift.metrics.jeffreys_divergence" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">jeffreys_divergence</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Computes Jeffreys divergence between two histograms as specified in this paper:
https://www.cs.cmu.edu/~efros/courses/LBMV07/Papers/rubner-jcviu-00.pdf
Both histograms are represented by numpy arrays with the same number of dimensions,
where each dimension represents the counts for that particular bin.
It is assumed that the bin edges are the same.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>p</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>First histogram. Each dimension represents one bin and bin edges are assumed to be the same as in q.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>q</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Second histogram. Each dimension represents one bin and bin edges are assumed to be the same as in p.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>normalize</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to normalize the histograms. If True the proportions of each bin are calculated first
and then the distance is calculated with the proportions</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>Returns</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(float): float representing the hellinger distance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/metrics.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">jeffreys_divergence</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes Jeffreys divergence between two histograms as specified in this paper:</span>
<span class="sd">    https://www.cs.cmu.edu/~efros/courses/LBMV07/Papers/rubner-jcviu-00.pdf</span>
<span class="sd">    Both histograms are represented by numpy arrays with the same number of dimensions,</span>
<span class="sd">    where each dimension represents the counts for that particular bin.</span>
<span class="sd">    It is assumed that the bin edges are the same.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (np.array): First histogram. Each dimension represents one bin and bin edges are assumed to be the same as in q.</span>
<span class="sd">        q (np.array): Second histogram. Each dimension represents one bin and bin edges are assumed to be the same as in p.</span>
<span class="sd">        normalize (bool): Whether to normalize the histograms. If True the proportions of each bin are calculated first</span>
<span class="sd">            and then the distance is calculated with the proportions</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): float representing the hellinger distance</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;p and q must have the same size and represent the same bins&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">rel_entr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">rel_entr</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="mercury.monitoring.drift.metrics.psi" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">psi</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Calculates the Population Stability Index (PSI). The metric helps to measure the stability between two population
samples. It assumes that the two population samples have already been splitted in bins, so the histograms are the
input to this function.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>p</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>First histogram. Each dimension represents one bin and bin edges are assumed to be the same as in q.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>q</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Second histogram. Each dimension represents one bin and bin edges are assumed to be the same as in p.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>normalize</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to normalize the histograms. If True the proportions of each bin are calculated first
and then the distance is calculated with the proportions</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>float representing the PSI</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div>
</details>
      <details class="quote">
        <summary>Source code in <code>mercury/monitoring/drift/metrics.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">psi</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Population Stability Index (PSI). The metric helps to measure the stability between two population</span>
<span class="sd">    samples. It assumes that the two population samples have already been splitted in bins, so the histograms are the</span>
<span class="sd">    input to this function.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (np.array): First histogram. Each dimension represents one bin and bin edges are assumed to be the same as in q.</span>
<span class="sd">        q (np.array): Second histogram. Each dimension represents one bin and bin edges are assumed to be the same as in p.</span>
<span class="sd">        normalize (bool): Whether to normalize the histograms. If True the proportions of each bin are calculated first</span>
<span class="sd">            and then the distance is calculated with the proportions</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): float representing the PSI</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; a = np.array([12, 11, 14, 12, 12, 10, 12, 6, 6, 5])</span>
<span class="sd">        &gt;&gt;&gt; b = np.array([11, 11, 12, 13, 11, 11, 13, 5, 7, 6])</span>
<span class="sd">        &gt;&gt;&gt; psi = psi(a, b)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;p and q must be np.array with len(shape)==1&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;p and q must have the same size and represent the same bins&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="c1"># Replace 0&#39;s to avoid inf and nans</span>
    <span class="n">p</span><span class="p">[</span><span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
    <span class="n">q</span><span class="p">[</span><span class="n">q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>

    <span class="n">psi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span> <span class="o">/</span> <span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>